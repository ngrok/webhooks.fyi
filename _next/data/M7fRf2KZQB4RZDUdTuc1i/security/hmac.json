{"pageProps":{"markdoc":{"content":[{"$$mdtype":"Tag","name":"table","attributes":{},"children":[{"$$mdtype":"Tag","name":"thead","attributes":{},"children":[]},{"$$mdtype":"Tag","name":"tbody","attributes":{},"children":[{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Complexity"]}]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Low"]}]}]}]},{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Pros"]}]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Authentication and Message Integrity with Low Complexity"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Secret keys are not sent in the webhook notification"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Hash signature enables timestamp validation"]}]}]}]},{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Caveats"]}]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["No confidentiality controls"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Introduces additional complexity with complex signature payloads"]}]}]}]},{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Examples"]}]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://docs.github.com/en/developers/webhooks-and-events/webhooks/securing-your-webhooks"},"children":["GitHub"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://shopify.dev/apps/webhooks/configuration/https#step-5-verify-the-webhook"},"children":["Shopify"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://api.slack.com/authentication/verifying-requests-from-slack"},"children":["Slack"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://developer.squareup.com/docs/webhooks/step3validate"},"children":["Square"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://www.twilio.com/docs/usage/security#validating-requests"},"children":["Twilio"]}]}]}]}]}]}]},{"$$mdtype":"Tag","name":"hr","attributes":{},"children":[]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Hash-based Message Authentication Code (HMAC) is, by far, the most popular authentication and message security method used on webhook requests, including 65% of the webhooks we studied. In this method, the webhook provider and listener use a secret key to sign and validate webhook requests."]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["On webhook requests, the provider signs the webhook message using the secret key plus a hashing algorithm — typically ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["HMAC-SHA256"]},", encodes the resulting signature in ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["base64"]}," or ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["hex"]},", and then includes the signature in the webhook request as a header."]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["The webhook listener receives the request and repeats the same steps — signs and encodes the webhook message using the secret key — and compares the resulting signature with the value sent in the request header. If the result matches, the request is considered legitimate."]},{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"js"},"children":["const signatureHeader = 'Signature-Header'\nconst signatureAlgorithm = 'sha256'\nconst encodeFormat = 'hex'\nconst hmacSecret = process.env.WEBHOOK_SECRET\n\napp.post('/webhook', (req, res) => {\n  // Create digest with payload + hmac secret\n  const hashPayload = req.rawBody\n  const hmac = crypto.createHmac(signatureAlgorithm, hmacSecret)\n  const digest = Buffer.from(signatureAlgorithm + '=' + hmac.update(hashPayload).digest(encodeFormat), 'utf8')\n  \n  // Get hash sent by the provider\n  const providerSig = Buffer.from(req.get(signatureHeader) || '', 'utf8')\n\n  // Compare digest signature with signature sent by provider\n  if (providerSig.length !== digest.length || !crypto.timingSafeEqual(digest, providerSig)) {\n    res.status(401).send('Unauthorized')\n  }else{\n    // Webhook Authenticated \n    // process and respond...\n    res.json({ message: \"Success\" })\n  }\n})\n"]}]}]},{"$$mdtype":"Tag","name":"DiagramHmac","attributes":{},"children":[]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"em","attributes":{},"children":["Request Signature Validation"]}]},{"$$mdtype":"Tag","name":"h2","attributes":{"id":"hmac-vs-shared-secrets"},"children":["HMAC vs. Shared Secrets"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["HMAC offers the following advantages over Basic Authentication:"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Authentication + message integrity"]},": Assuming the secret key is known only by the webhook provider and the listener, the HMAC process verifies that the message comes from the webhook provider (authenticity) and its contents are the same as they were at the time of sending (integrity)."]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["The secret key remains secret:"]}," In HMAC, secret keys are not sent with the webhook request — only the signatures created with it — reducing the risk of stolen keys."]}]},{"$$mdtype":"Tag","name":"h2","attributes":{"id":"hmac-is-only-as-good-as-its-implementation"},"children":["HMAC is only as good as its implementation"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Like any other security control, HMAC is only as good as its implementation. In our research, we saw many examples of webhook providers with unnecessary complexity, lack of features, and complex documentation that made their solutions tough to implement and keep safe. Good webhook implementations will typically:"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Use strong hash algorithms such as ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["sha256"]}," and ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["sha512"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Add sensitive headers to the hash digest:",{"$$mdtype":"Tag","name":"Fence","attributes":{"language":"js"},"children":["...\nconst clientIdHeader = 'clientid'\n...\napp.post('/webhook', (req, res) => {\n  // Create digest from the request payload and the clientid header\n  const hashPayload = req.rawBody+'.'+req.get(clientIdHeader)\n  const hmac = crypto.createHmac(signatureAlgorithm, hmacSecret)\n  const digest = Buffer.from(signatureAlgorithm + '=' + hmac.update(hashPayload).digest(encodeFormat), 'utf8')\n  ...\n})\n"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Leverage HMAC signatures to implement ",{"$$mdtype":"Tag","name":"a","attributes":{"href":"/security/replay-prevention"},"children":["replay prevention"]},", ",{"$$mdtype":"Tag","name":"a","attributes":{"href":"/ops-experience/versioning"},"children":["versioning"]},", and ",{"$$mdtype":"Tag","name":"a","attributes":{"href":"/ops-experience/key-rotation"},"children":["key rotation"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Provide great ",{"$$mdtype":"Tag","name":"a","attributes":{"href":"/ops-experience/documentation"},"children":["documentation"]}," and features for better ",{"$$mdtype":"Tag","name":"a","attributes":{"href":"/ops-experience/intro"},"children":["operations"]}]}]}],"frontmatter":{"title":"Hash-based Message Authentication Code (HMAC)","description":"HMAC is, by far, the most popular authentication and message security method used on webhook requests, including 65% of the 100 webhooks we studied. In this method, the webhook provider and listener use a secret key to sign and validate webhook requests."},"file":{"path":"/security/hmac.md"}}},"__N_SSG":true}